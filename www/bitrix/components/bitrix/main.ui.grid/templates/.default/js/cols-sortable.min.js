(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.ColsSortable=function(t){this.parent=null;this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null;this.init(t)};BX.Grid.ColsSortable.prototype={init:function(t){var i,s;var e=this;this.parent=t;this.colsList=this.getColsList();this.rowsList=this.parent.getRows().getSourceRows();if(this.isPinned&&this.parent.getParam("ALLOW_PIN_HEADER")){i=this.parent.getPinHeader().getFixedTable();s=BX.Grid.Utils.getByTag(i,"tr");(s||[]).forEach(function(t){e.rowsList.push(t)})}this.registerObjects();if(!this.inited){this.inited=true;BX.addCustomEvent("Grid::headerPinned",BX.proxy(this._onPin,this));BX.addCustomEvent("Grid::headerUnpinned",BX.proxy(this._onUnpin,this))}},destroy:function(){BX.removeCustomEvent("Grid::headerPinned",BX.proxy(this._onPin,this));BX.removeCustomEvent("Grid::headerUnpinned",BX.proxy(this._onUnpin,this));this.unregisterObjects()},_onPin:function(){this.isPinned=true;this.reinit()},_onUnpin:function(){this.isPinned=false;this.reinit()},reinit:function(){this.unregisterObjects();this.reset();this.init(this.parent)},reset:function(){this.dragItem=null;this.targetItem=null;this.rowsList=null;this.colsList=null;this.dragRect=null;this.offset=null;this.startDragOffset=null;this.dragColumn=null;this.targetColumn=null;this.isDrag=null},isActive:function(){return this.isDrag},registerObjects:function(t){var i=this;[].forEach.call(t||this.colsList,function(t){t.onbxdragstart=BX.delegate(i._onDragStart,i);t.onbxdrag=BX.delegate(i._onDrag,i);t.onbxdragstop=BX.delegate(i._onDragEnd,i);jsDD.registerObject(t);jsDD.registerDest(t)})},unregisterObjects:function(){[].forEach.call(this.colsList,function(t){jsDD.unregisterObject(t);jsDD.unregisterDest(t)})},getColsList:function(){var t=this;var i=[];var s;if(this.isPinned&&this.parent.getParam("ALLOW_PIN_HEADER")){s=this.parent.getPinHeader().getFixedTable();i=BX.Grid.Utils.getByTag(s,"th")}else{i=this.parent.getRows().getHeadFirstChild().getCells()}i=[].filter.call(i,function(i){return!t.isStatic(i)});return i},isStatic:function(t){return BX.hasClass(t,this.parent.settings.get("classCellStatic"))},getDragOffset:function(){return jsDD.x-this.startDragOffset-this.dragRect.left},getColumn:function(t){var i=BX.Grid.Utils.getColumn(this.parent.getTable(),t);if(i.indexOf(t)===-1){i.push(t)}return i},_onDragStart:function(){this.isDrag=true;this.dragItem=jsDD.current_node;this.dragRect=this.dragItem.getBoundingClientRect();this.offset=Math.ceil(this.dragRect.width);this.startDragOffset=jsDD.start_x-this.dragRect.left;this.dragColumn=this.getColumn(this.dragItem);this.dragIndex=BX.Grid.Utils.getIndex(this.colsList,this.dragItem)},isDragToRight:function(t,i){var s=t.getBoundingClientRect();var e=Math.ceil(s.left+s.width/2+BX.scrollLeft(window));var n=this.dragIndex;var r=jsDD.x;return i>n&&r>e},isDragToLeft:function(t,i){var s=t.getBoundingClientRect();var e=Math.ceil(s.left+s.width/2+BX.scrollLeft(window));var n=this.dragIndex;var r=jsDD.x;return i<n&&r<e},isDragToBack:function(t,i){var s=t.getBoundingClientRect();var e=Math.ceil(s.left+s.width/2+BX.scrollLeft(window));var n=this.dragIndex;var r=jsDD.x;return i>n&&r<e||i<n&&r>e},isMovedToRight:function(t){return t.style.transform==="translate3d("+-this.offset+"px, 0px, 0px)"},isMovedToLeft:function(t){return t.style.transform==="translate3d("+this.offset+"px, 0px, 0px)"},isMoved:function(t){return t.style.transform!=="translate3d(0px, 0px, 0px)"&&t.style.transform!==""},moveColumn:function(t,i,s){s=BX.type.isNumber(s)?s:300;BX.Grid.Utils.styleForEach(t,{transition:s+"ms",transform:"translate3d("+i+"px, 0px, 0px)"})},_onDrag:function(){this.dragOffset=this.getDragOffset();this.targetItem=this.targetItem||this.dragItem;this.targetColumn=this.targetColumn||this.dragColumn;var t=-this.offset;var i=this.offset;var s=0;var e=0;this.moveColumn(this.dragColumn,this.dragOffset,e);[].forEach.call(this.colsList,function(e,n){if(e){if(this.isDragToRight(e,n)&&!this.isMovedToRight(e)){this.targetColumn=this.getColumn(e);this.moveColumn(this.targetColumn,t)}if(this.isDragToLeft(e,n)&&!this.isMovedToLeft(e)){this.targetColumn=this.getColumn(e);this.moveColumn(this.targetColumn,i)}if(this.isDragToBack(e,n)&&this.isMoved(e)){this.targetColumn=this.getColumn(e);this.moveColumn(this.targetColumn,s)}}},this)},_onDragEnd:function(){var t=this;var i=[];[].forEach.call(this.dragColumn,function(i,s){BX.Grid.Utils.collectionSort(i,t.targetColumn[s])});[].forEach.call(this.rowsList,function(t){BX.Grid.Utils.styleForEach(t.cells,{transition:"",transform:""})});this.reinit();[].forEach.call(this.colsList,function(t){i.push(BX.data(t,"name"))});this.parent.getUserOptions().setColumns(i);BX.onCustomEvent(this.parent.getContainer(),"Grid::columnMoved",[this.parent])}}})();
//# sourceMappingURL=cols-sortable.map.js