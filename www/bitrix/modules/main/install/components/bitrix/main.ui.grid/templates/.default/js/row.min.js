(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.Row=function(t,e){this.node=null;this.checkbox=null;this.sort=null;this.actions=null;this.settings=null;this.index=null;this.actionsButton=null;this.parent=null;this.depth=null;this.parentId=null;this.editData=null;this.init(t,e)};BX.Grid.Row.prototype={init:function(t,e){if(BX.type.isDomNode(e)){this.node=e;this.parent=t;this.settings=new BX.Grid.Settings;if(this.parent.getParam("ALLOW_CONTEXT_MENU")){BX.bind(this.getNode(),"contextmenu",BX.delegate(this._onRightClick,this))}}},_onRightClick:function(t){t.preventDefault();this.showActionsMenu(t)},getDefaultAction:function(){return BX.data(this.getNode(),"default-action")},editGetValues:function(){var t=this;var e=this.getCells();var i={};var n;[].forEach.call(e,function(e){n=t.getCellEditorValue(e);if(n){i[n.NAME]=n.VALUE!==undefined?n.VALUE:""}});return i},getCellEditorValue:function(t){var e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditor"),true);var i=null;if(BX.type.isDomNode(e)){if(BX.hasClass(e,"main-grid-editor-checkbox")){i={NAME:e.getAttribute("name"),VALUE:e.checked?"Y":"N"}}else{if(e.value){i={NAME:e.getAttribute("name"),VALUE:e.value}}else{i={NAME:e.getAttribute("name"),VALUE:BX.data(e,"value")}}}}return i},isEdit:function(){return BX.hasClass(this.getNode(),"main-grid-row-edit")},hide:function(){BX.addClass(this.getNode(),this.parent.settings.get("classHide"))},show:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classHide"))},isShown:function(){return!BX.hasClass(this.getNode(),this.parent.settings.get("classHide"))},getContentContainer:function(t){var e=null;if(!BX.hasClass(t,this.parent.settings.get("classCellContainer"))){if(t.nodeName==="TD"||t.nodeName==="TR"){e=BX.Grid.Utils.getByClass(t,this.parent.settings.get("classCellContainer"),true)}else{e=BX.findParent(t,{className:this.parent.settings.get("classCellContainer")},true,false)}}else{e=t}return e},getContent:function(t){var e=this.getContentContainer(t);var i;if(BX.type.isDomNode(e)){i=BX.html(e)}return i},getEditorContainer:function(t){return BX.Grid.Utils.getByClass(t,this.parent.settings.get("classEditorContainer"),true)},getCollapseButton:function(){if(!this.collapseButton){this.collapseButton=BX.Grid.Utils.getByClass(this.getNode(),this.parent.settings.get("classCollapseButton"),true)}return this.collapseButton},stateLoad:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateUnload:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateLoad"))},stateExpand:function(){BX.addClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},stateCollapse:function(){BX.removeClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},getParentId:function(){if(this.parentId===null){this.parentId=BX.data(this.getNode(),"parent-id")}return this.parentId},getDepth:function(){if(this.depth===null){this.depth=BX.data(this.getNode(),"depth")}return this.depth},showChildRows:function(){var t=this.parent.getRows().getRowsByParentId(this.getId());t.forEach(function(t){t.show();if(t.isExpand()){t.showChildRows()}});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},hideChildRows:function(){var t=this.parent.getRows().getRowsByParentId(this.getId(),true);t.forEach(function(t){t.hide()});this.parent.updateCounterDisplayed();this.parent.updateCounterSelected();this.parent.adjustCheckAllCheckboxes();this.parent.adjustRows()},isChildsLoaded:function(){if(!BX.type.isBoolean(this.childsLoaded)){this.childsLoaded=BX.data(this.getNode(),"child-loaded")=="true"}return this.childsLoaded},expand:function(){var t=this;this.stateExpand();if(this.isChildsLoaded()){this.showChildRows()}else{this.stateLoad();this.loadChildRows(function(e){e.reverse().forEach(function(e){BX.insertAfter(e,t.getNode())});t.parent.getRows().reset();t.parent.bindOnRowEvents();t.stateUnload();BX.data(t.getNode(),"child-loaded","true");t.parent.updateCounterDisplayed();t.parent.updateCounterSelected();t.parent.adjustCheckAllCheckboxes()})}},collapse:function(){this.stateCollapse();this.hideChildRows()},isExpand:function(){return BX.hasClass(this.getNode(),this.parent.settings.get("classRowStateExpand"))},toggleChildRows:function(){if(!this.isExpand()){this.expand()}else{this.collapse()}},loadChildRows:function(t){if(BX.type.isFunction(t)){var e=this;var i=parseInt(this.getDepth());var n=this.parent.getUserOptions().getAction("GRID_GET_CHILD_ROWS");i=BX.type.isNumber(i)?i+1:1;this.parent.getData().request("","POST",{action:n,parent_id:this.getId(),depth:i},null,function(){var i=this.getRowsByParentId(e.getId());t.apply(null,[i])})}},update:function(t,e,i){var n=this.parent.getUserOptions().getAction("GRID_UPDATE_ROW");var s=this.getDepth();var a=this.getId();var o=this.getParentId();var r={id:a,parentId:o,action:n,depth:s,data:t};var d=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,function(){var e=this.getBodyRows();d.parent.getUpdater().updateBodyRows(e);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(e);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowUpdated",[{id:a,data:t,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[]);if(BX.type.isFunction(i)){i({id:a,data:t,grid:d.parent,response:this})}})},remove:function(t,e,i){var n=this.parent.getUserOptions().getAction("GRID_DELETE_ROW");var s=this.getDepth();var a=this.getId();var o=this.getParentId();var r={id:a,parentId:o,action:n,depth:s,data:t};var d=this;this.stateLoad();this.parent.getData().request(e,"POST",r,null,function(){var e=this.getBodyRows();d.parent.getUpdater().updateBodyRows(e);d.stateUnload();d.parent.getRows().reset();d.parent.getUpdater().updateFootRows(this.getFootRows());d.parent.getUpdater().updatePagination(this.getPagination());d.parent.getUpdater().updateMoreButton(this.getMoreButton());d.parent.getUpdater().updateCounterTotal(this.getCounterTotal());d.parent.bindOnRowEvents();d.parent.adjustEmptyTable(e);d.parent.bindOnMoreButtonEvents();d.parent.bindOnClickPaginationLinks();d.parent.updateCounterDisplayed();d.parent.updateCounterSelected();if(d.parent.getParam("ALLOW_COLUMNS_SORT")){d.parent.colsSortable.reinit()}if(d.parent.getParam("ALLOW_ROWS_SORT")){d.parent.rowsSortable.reinit()}BX.onCustomEvent(window,"Grid::rowRemoved",[{id:a,data:t,grid:d.parent,response:this}]);BX.onCustomEvent(window,"Grid::updated",[]);if(BX.type.isFunction(i)){i({id:a,data:t,grid:d.parent,response:this})}})},editCancel:function(){var t=this.getCells();var e=this;var i;[].forEach.call(t,function(t){i=e.getEditorContainer(t);if(BX.type.isDomNode(i)){BX.remove(e.getEditorContainer(t));BX.show(e.getContentContainer(t))}});BX.removeClass(this.getNode(),"main-grid-row-edit")},getCellByIndex:function(t){return this.getCells()[t]},getEditDataByCellIndex:function(index){return eval(BX.data(this.getCellByIndex(index),"edit"))},getCellNameByCellIndex:function(t){return BX.data(this.getCellByIndex(t),"name")},getEditData:function(){if(this.editData===null){var t=this.parent.getParam("EDITABLE_DATA");var e=this.getId();if(BX.type.isPlainObject(t)&&e in t){this.editData=t[e]}else{this.editData={}}}return this.editData},getCellEditDataByCellIndex:function(t){var e=this.getEditData();var i=null;t=parseInt(t);if(BX.type.isNumber(t)&&BX.type.isPlainObject(e)){var n=this.parent.getRows().getHeadFirstChild().getEditDataByCellIndex(t);if(BX.type.isPlainObject(n)){i=n;i.VALUE=e[n.NAME]}}return i},edit:function(){var t=this.getCells();var e=this;var i,n,s,a;[].forEach.call(t,function(t,o){try{i=e.getCellEditDataByCellIndex(o)}catch(r){throw new Error(r)}if(e.parent.getEditor().validateEditObject(i)){a=e.getContentContainer(t);s=BX.height(a);n=e.parent.getEditor().getEditor(i,s);if(!e.getEditorContainer(t)&&BX.type.isDomNode(n)){t.appendChild(n);BX.hide(a)}}});BX.addClass(this.getNode(),"main-grid-row-edit")},setDraggable:function(t){this.getNode().draggable=t?"true":"false"},getNode:function(){return this.node},getIndex:function(){return this.getNode().rowIndex},getId:function(){return BX.data(this.getNode(),"id")},getObserver:function(){return BX.Grid.observer},getCheckbox:function(){if(!this.checkbox){this.checkbox=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowCheckbox"),true)}return this.checkbox},getActionsMenu:function(){if(!this.actionsMenu){var t=this.getActionsButton().getBoundingClientRect();this.actionsMenu=BX.PopupMenu.create("main-grid-actions-menu-"+this.getIndex(),this.getActionsButton(),this.getMenuItems(),{autoHide:true,offsetTop:-(t.height/2+26),offsetLeft:30,angle:{position:"left",offset:t.height/2-8},events:{onPopupClose:BX.delegate(this._onCloseMenu,this)}});BX.bind(this.actionsMenu.popupWindow.popupContainer,"click",BX.delegate(function(){var t=this.getActionsMenu();if(t){t.close()}},this))}return this.actionsMenu},_onCloseMenu:function(){},actionsMenuIsShown:function(){return this.getActionsMenu().popupWindow.isShown()},showActionsMenu:function(t){var e=BX.pos(this.getActionsButton());BX.PopupMenu.destroy("main-grid-actions-menu-"+this.getIndex());this.actionsMenu=null;if(t){BX.fireEvent(document.body,"click");this.getActionsMenu().popupWindow.setOffset({offsetLeft:t.pageX-e.left+20,offsetTop:t.pageY-e.top-30})}else{this.getActionsMenu().popupWindow.adjustPosition(e)}this.getActionsMenu().popupWindow.show()},closeActionsMenu:function(){if(this.actionsMenu){if(this.actionsMenu.popupWindow){this.actionsMenu.popupWindow.close()}this.actionsMenu=null}},getMenuItems:function(){return this.getActions()||[]},getActions:function(){try{this.actions=this.actions||eval(BX.data(this.getActionsButton(),this.settings.get("dataActionsKey")))}catch(err){this.actions=null}return this.actions},getActionsButton:function(){if(!this.actionsButton){this.actionsButton=BX.Grid.Utils.getByClass(this.getNode(),this.settings.get("classRowActionButton"),true)}return this.actionsButton},initSelect:function(){if(this.isSelected()&&!BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"))}},getParentNode:function(){var t;try{t=this.getNode().parentNode}catch(e){t=null}return t},getParentNodeName:function(){var t;try{t=this.getParentNode().nodeName}catch(e){t=null}return t},select:function(){var t;if(!this.isEdit()){t=this.getCheckbox();if(t){if(!BX.data(t,"disabled")){BX.addClass(this.getNode(),this.settings.get("classCheckedRow"));t.checked=true}}}},unselect:function(){if(!this.isEdit()){BX.removeClass(this.getNode(),this.settings.get("classCheckedRow"));if(this.getCheckbox()){this.getCheckbox().checked=false}}},getCells:function(){return this.getNode().cells},isSelected:function(){return this.getCheckbox()&&this.getCheckbox().checked||BX.hasClass(this.getNode(),this.settings.get("classCheckedRow"))},isHeadChild:function(){return this.getParentNodeName()==="THEAD"&&BX.hasClass(this.getNode(),this.settings.get("classHeadRow"))},isBodyChild:function(){return BX.hasClass(this.getNode(),this.settings.get("classBodyRow"))&&!BX.hasClass(this.getNode(),this.settings.get("classEmptyRows"))},isFootChild:function(){return this.getParentNodeName()==="TFOOT"&&BX.hasClass(this.getNode(),this.settings.get("classFootRow"))}}})();
//# sourceMappingURL=row.map.js